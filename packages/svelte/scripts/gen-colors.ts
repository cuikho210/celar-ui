/**
 * Generate SCSS theme from Material Color Utilities theme output.
 * Usage: bun gen-material-theme-scss.ts <output-path>
 *
 * This script generates a SCSS file with $material-theme-light and $material-theme-dark maps,
 * using the output of Material Color Utilities' themeFromSourceColor.
 */

import {
	argbFromHex,
	hexFromArgb,
	Scheme,
	themeFromSourceColor
} from '@material/material-color-utilities';
import path from 'node:path';

// ---- CONFIGURABLE SOURCE COLOR / OUTPUT ----
const argv = Bun.argv.slice(2);
const getFlag = (names: string[]) => {
	const i = argv.findIndex((a) => names.includes(a));
	if (i >= 0 && argv[i + 1] && !argv[i + 1].startsWith('--')) return argv[i + 1];
	const kv = argv.find((a) => names.some((n) => a.startsWith(`${n}=`)));
	return kv ? kv.split('=').slice(1).join('=') : undefined;
};
const sourceColor = (getFlag(['--color', '-c']) || Bun.env.SOURCE_COLOR || '#ff907f').trim();
const outputPath = path.resolve(
	process.cwd(),
	getFlag(['--out', '-o']) || Bun.env.OUTPUT_PATH || 'src/styles/scheme.scss'
);

// ---- GENERATE THEME ----
const theme = themeFromSourceColor(argbFromHex(sourceColor));

// ---- SCSS OUTPUT ----
function toScssMap(name: string, obj: Scheme): string {
	const props = obj.toJSON();
	const entries = Object.entries(props)
		.map(([k, v]) => `  color-${k}: ${hexFromArgb(v)}`)
		.join(',\n');
	return `$${name}: (\n${entries}\n);\n`;
}

const scss = `// Generated by gen-material-theme-scss.ts
// Source color: ${sourceColor}

${toScssMap('scheme-light', theme.schemes.light)}
${toScssMap('scheme-dark', theme.schemes.dark)}
`;

// ---- WRITE FILE ----
await Bun.write(outputPath, scss);
console.log(`Material theme SCSS written to ${outputPath}`);
